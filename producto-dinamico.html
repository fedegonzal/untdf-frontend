<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos del Supermercado</title>
</head>

<body>

    <div id="lista-productos">
    </div>

    <!-- Import the web component -->
    <script src="/components/ProductoItem.js"></script>

    <script>
        fetch(`http://161.35.104.211:8000/products/2`, {
            headers: {
                'accept': 'application/json',
                'Authorization': 'Bearer fedegonzal'
            }
        })
        .then(res => res.json())
        .then(product => renderProduct(product))
        .catch(err => this.renderError(err));

        function renderError(error) {
            console.error('Error fetching product:', error);
            document.querySelector('#lista-productos').innerHTML = `
                <p class="text-red-500">Error al cargar los productos. Inténtalo de nuevo más tarde.</p>
            `;
        }

        function renderProduct(product) {
            const listProductos = document.querySelector('#lista-productos');
            listProductos.innerHTML = ''; // Limpiamos el contenido existente, si hubiera

            // Multiplicamos product.price x 1000 y le quitamos los decimales
            product.price = Math.floor(product.price * 1000);

            const productItem = document.createElement('producto-item');
            productItem.setAttribute('title', product.title);
            productItem.setAttribute('picture', `http://161.35.104.211:8000${product.pictures[0]}`);
            productItem.setAttribute('description', product.description);
            productItem.setAttribute('price', product.price);
            listProductos.appendChild(productItem);
        }

    </script>

</body>

</html>